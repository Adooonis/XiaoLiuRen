<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°å…­å£¬ç¥è¯¾ - ä¼ ç»Ÿèµ·å¦å·¥å…·</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="ä¼ ç»Ÿå°å…­å£¬èµ·å¦å·¥å…·ï¼Œå¤æ³•ç¥æœºå¦™ç®—ï¼Œè¶‹å‰é¿å‡¶">
    <meta name="theme-color" content="#A42A28">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="å°å…­å£¬">
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="shortcut icon" href="icon-192.png">
    <style>
        /* å¼•å…¥Google Fonts - æ€æºå®‹ä½“å’Œä»¿å®‹ä½“ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Serif SC', serif;
            background: linear-gradient(135deg, #F5F1E9 0%, #F2EDDD 100%);
            color: #2E2E2E;
            min-height: 100vh;
            padding: 16px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #EFEADF;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(46, 46, 46, 0.08);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #A42A28 0%, #8B241F 100%);
            color: #F5F1E9;
            text-align: center;
            padding: 32px 24px;
        }
        
        .main-title {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .content {
            padding: 32px 24px;
        }
        
        .section {
            margin-bottom: 32px;
        }
        
        .section-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 24px;
            color: #2E2E2E;
            border-bottom: 2px solid #A98B4F;
            padding-bottom: 8px;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #2E2E2E;
        }
        
        .form-textarea {
            width: 100%;
            height: 80px;
            background: #F5F1E9;
            border: 1px solid #D1CBBF;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Noto Serif SC', serif;
            font-size: 16px;
            color: #2E2E2E;
            resize: vertical;
            transition: border-color 250ms ease;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #A98B4F;
        }
        
        .radio-group {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            background: transparent;
            border: 1px solid #D1CBBF;
            border-radius: 4px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 250ms ease;
            flex: 1;
        }
        
        .radio-option:hover {
            border-color: #A98B4F;
        }
        
        .radio-option.selected {
            background: #A42A28;
            border-color: #A42A28;
            color: #F5F1E9;
        }
        
        .radio-option input[type="radio"] {
            margin-right: 8px;
        }
        
        .lunar-inputs {
            display: none;
            gap: 16px;
            margin-top: 16px;
        }
        
        .lunar-inputs.show {
            display: flex;
        }
        
        .lunar-select {
            flex: 1;
            background: #F5F1E9;
            border: 1px solid #D1CBBF;
            border-radius: 4px;
            padding: 8px 12px;
            font-family: 'Noto Serif SC', serif;
            font-size: 16px;
            color: #2E2E2E;
        }
        
        .numbers-input {
            display: none;
            gap: 16px;
            margin-top: 16px;
        }
        
        .numbers-input.show {
            display: flex;
        }
        
        .number-input {
            flex: 1;
            background: #F5F1E9;
            border: 1px solid #D1CBBF;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Noto Serif SC', serif;
            font-size: 16px;
            text-align: center;
            color: #2E2E2E;
        }
        
        .number-input:focus {
            outline: none;
            border-color: #A98B4F;
        }
        
        .submit-btn {
            background: #A42A28;
            color: #F5F1E9;
            border: none;
            border-radius: 4px;
            padding: 12px 48px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 250ms ease;
            font-family: 'Noto Serif SC', serif;
        }
        
        .submit-btn:hover {
            background: #C0322F;
            transform: translateY(-2px);
        }
        
        .submit-btn:disabled {
            background: #6D6D6D;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-section {
            display: none;
            border-top: 1px solid #D1CBBF;
            padding-top: 32px;
            margin-top: 32px;
        }
        
        .result-section.show {
            display: block;
        }
        
        .divination-summary {
            background: #F5F1E9;
            padding: 24px;
            border-radius: 4px;
            margin-bottom: 24px;
            border-left: 4px solid #A98B4F;
        }
        
        .summary-title {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 12px;
            color: #A98B4F;
        }
        
        .summary-content {
            font-size: 24px;
            font-weight: 500;
            text-align: center;
            color: #2E2E2E;
        }
        
        .divine-god {
            margin: 0 8px;
        }
        
        .god-jious {
            color: #3E7765;
        }
        
        .god-xiong {
            color: #8B4513;
        }
        
        .god-details {
            margin-top: 24px;
        }
        
        .god-card {
            background: transparent;
            border: 1px dashed #D1CBBF;
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 16px;
        }
        
        .god-name {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .god-quote {
            font-size: 16px;
            font-style: italic;
            color: #6D6D6D;
            margin-bottom: 12px;
        }
        
        .god-explanation {
            font-size: 16px;
            line-height: 1.7;
            color: #2E2E2E;
        }
        
        .advice-section {
            background: #F5F1E9;
            padding: 24px;
            border-radius: 4px;
            margin-top: 24px;
            border-left: 4px solid #A98B4F;
        }
        
        .advice-title {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #A98B4F;
        }
        
        .advice-content {
            font-size: 16px;
            line-height: 1.7;
            color: #2E2E2E;
        }
        
        .reset-btn {
            background: transparent;
            color: #A98B4F;
            border: 1px solid #A98B4F;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 16px;
            transition: all 250ms ease;
            font-family: 'Noto Serif SC', serif;
        }
        
        .reset-btn:hover {
            background: #A98B4F;
            color: #F5F1E9;
        }
        
        .copy-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .copy-btn {
            background: #3E7765;
            color: #F5F1E9;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 250ms ease;
            font-family: 'Noto Serif SC', serif;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .copy-btn:hover {
            background: #2D5F47;
            transform: translateY(-1px);
        }
        
        .copy-btn:disabled {
            background: #6D6D6D;
            cursor: not-allowed;
            transform: none;
        }
        
        .copy-icon {
            font-size: 16px;
        }
        
        .copy-text {
            font-weight: 500;
        }
        
        .copy-feedback {
            font-size: 14px;
            color: #3E7765;
            font-weight: 500;
        }
        
        .success-text {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        

        
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }
            
            .main-title {
                font-size: 36px;
            }
            
            .section-title {
                font-size: 24px;
            }
            
            .radio-group {
                flex-direction: column;
            }
            
            .lunar-inputs {
                flex-direction: column;
            }
            
            .numbers-input {
                flex-direction: column;
            }
            
            .content {
                padding: 24px 16px;
            }
            
            /* ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸ä½“éªŒ */
            .radio-option, .lunar-select, .number-input {
                min-height: 48px;
                font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
            }
            
            .submit-btn {
                width: 100%;
                font-size: 18px;
                padding: 16px;
            }
            
            .form-textarea {
                font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
            }
            
            /* ç§»åŠ¨ç«¯ä¼˜åŒ–æ»šåŠ¨ */
            .result-section {
                -webkit-overflow-scrolling: touch;
            }
            
            /* ä¼˜åŒ–æ–‡å­—å¤§å°é˜²æ­¢ç¼©æ”¾ */
            .god-name {
                font-size: 18px;
            }
            
            .god-explanation {
                font-size: 15px;
            }
            
            .summary-content {
                font-size: 20px;
            }
            
            /* ç§»åŠ¨ç«¯å®‰è£…æŒ‰é’®ä¼˜åŒ– */
            .install-button-mobile {
                bottom: 16px !important;
                font-size: 13px !important;
                padding: 10px 20px !important;
            }
            
            /* ç§»åŠ¨ç«¯å¤åˆ¶æŒ‰é’®ä¼˜åŒ– */
            .copy-btn {
                min-height: 44px;
                font-size: 15px;
                padding: 10px 16px;
            }
            
            .copy-section {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .copy-feedback {
                text-align: center;
            }
        }
        
        /* ç§»åŠ¨ç«¯æ¨ªå±ä¼˜åŒ– */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                padding: 20px 24px;
            }
            
            .main-title {
                font-size: 28px;
                margin-bottom: 4px;
            }
            
            .content {
                padding: 16px;
            }
        }
        
        /* iOS Safariç‰¹å®šä¼˜åŒ– */
        @supports (-webkit-touch-callout: none) {
            body {
                -webkit-user-select: none;
                user-select: none;
            }
            
            .form-textarea, .number-input, input, select, textarea {
                -webkit-user-select: text;
                user-select: text;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #A98B4F;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ */
        @media (prefers-contrast: high) {
            .container {
                border: 2px solid #2E2E2E;
            }
            
            .god-jious {
                color: #2D5F47 !important;
                font-weight: bold;
            }
            
            .god-xiong {
                color: #654321 !important;
                font-weight: bold;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="main-title">å°å…­å£¬ç¥è¯¾</h1>
            <p class="subtitle">å¤æ³•èµ·å¦ Â· ç¥æœºå¦™ç®— Â· è¶‹å‰é¿å‡¶</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2 class="section-title">è¾“å…¥æµ‹ç®—ä¿¡æ¯</h2>
                
                <div class="form-group">
                    <label class="form-label">è¯·è¾“å…¥æ‚¨æƒ³æµ‹ç®—çš„é—®é¢˜ï¼š</label>
                    <textarea class="form-textarea" id="question" placeholder="è¯·åœ¨æ­¤è¾“å…¥æ‚¨æƒ³æµ‹ç®—çš„é—®é¢˜ï¼Œå¦‚'ä»Šæ—¥å‡ºè¡Œæ˜¯å¦é¡ºåˆ©ï¼Ÿ'ã€'æœ¬æœˆå·¥ä½œè¿åŠ¿å¦‚ä½•ï¼Ÿ'ç­‰"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">é€‰æ‹©èµ·å¦æ–¹å¼ï¼š</label>
                    <div class="radio-group">
                        <div class="radio-option selected" data-value="numbers">
                            <input type="radio" name="divination-type" value="numbers" checked>
                            éšæœºä¸‰æ•°
                        </div>
                        <div class="radio-option" data-value="lunar">
                            <input type="radio" name="divination-type" value="lunar">
                            é˜´å†æ—¶è¾°
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="numbers-input show" id="numbers-input">
                        <input type="number" class="number-input" id="num1" placeholder="ç¬¬ä¸€ä¸ªæ•°å­—" min="1" max="999">
                        <input type="number" class="number-input" id="num2" placeholder="ç¬¬äºŒä¸ªæ•°å­—" min="1" max="999">
                        <input type="number" class="number-input" id="num3" placeholder="ç¬¬ä¸‰ä¸ªæ•°å­—" min="1" max="999">
                    </div>
                    
                    <div class="lunar-inputs" id="lunar-input">
                        <select class="lunar-select" id="lunar-month">
                            <option value="">é€‰æ‹©é˜´å†æœˆä»½</option>
                            <option value="1">æ­£æœˆ</option>
                            <option value="2">äºŒæœˆ</option>
                            <option value="3">ä¸‰æœˆ</option>
                            <option value="4">å››æœˆ</option>
                            <option value="5">äº”æœˆ</option>
                            <option value="6">å…­æœˆ</option>
                            <option value="7">ä¸ƒæœˆ</option>
                            <option value="8">å…«æœˆ</option>
                            <option value="9">ä¹æœˆ</option>
                            <option value="10">åæœˆ</option>
                            <option="11">å†¬æœˆ</option>
                            <option value="12">è…Šæœˆ</option>
                        </select>
                        <select class="lunar-select" id="lunar-day">
                            <option value="">é€‰æ‹©æ—¥æœŸ</option>
                        </select>
                        <select class="lunar-select" id="lunar-hour">
                            <option value="">é€‰æ‹©æ—¶è¾°</option>
                            <option value="1">å­æ—¶ (23:00-1:00)</option>
                            <option value="2">ä¸‘æ—¶ (1:00-3:00)</option>
                            <option value="3">å¯…æ—¶ (3:00-5:00)</option>
                            <option value="4">å¯æ—¶ (5:00-7:00)</option>
                            <option value="5">è¾°æ—¶ (7:00-9:00)</option>
                            <option value="6">å·³æ—¶ (9:00-11:00)</option>
                            <option value="7">åˆæ—¶ (11:00-13:00)</option>
                            <option value="8">æœªæ—¶ (13:00-15:00)</option>
                            <option value="9">ç”³æ—¶ (15:00-17:00)</option>
                            <option value="10">é…‰æ—¶ (17:00-19:00)</option>
                            <option value="11">æˆŒæ—¶ (19:00-21:00)</option>
                            <option value="12">äº¥æ—¶ (21:00-23:00)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <button class="submit-btn" id="submit-btn">å¼€å§‹æµ‹ç®—</button>
                </div>
            </div>
            
            <div class="result-section" id="result-section">
                <h2 class="section-title">æ¨æ¼”ç»“æœ</h2>
                
                <div class="divination-summary">
                    <div class="summary-title">å¦è±¡æ€»è§ˆ</div>
                    <div class="summary-content" id="summary-content">
                        <!-- ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="god-details" id="god-details">
                    <!-- å…­ç¥è¯¦è§£å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="advice-section">
                    <div class="advice-title">ç”ŸæˆAIæŒ‡ä»¤</div>
                    <div class="advice-content" id="advice-content">
                        <!-- å»ºè®®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="copy-section" style="margin-top: 16px;">
                        <button class="copy-btn" id="copy-btn">
                            <span class="copy-icon">ğŸ“‹</span>
                            <span class="copy-text">å¤åˆ¶æŒ‡ä»¤</span>
                        </button>
                        <div class="copy-feedback" id="copy-feedback" style="display: none;">
                            <span class="success-text">âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</span>
                        </div>
                    </div>
                </div>
                

                
                <button class="reset-btn" id="reset-btn">é‡æ–°æµ‹ç®—</button>
            </div>
        </div>
    </div>

    <script>
        // å…­ç¥æ•°æ®å®šä¹‰
        const godsData = {
            'å¤§å®‰': {
                isJious: true,
                quote: 'å¤§å®‰äº‹äº‹æ˜Œï¼Œæ±‚è´¢åœ¨å¤æ–¹ï¼Œå¤±ç‰©å»ä¸è¿œï¼Œå®…èˆä¿å®‰åº·',
                explanation: 'å¤§å®‰ä¸ºé’é¾™æœ¨ï¼Œå±æ˜¥å¤©ï¼Œä½åœ¨ä¸œæ–¹ã€‚å¤§å®‰ä¸»é™ã€ä¸åŠ¨ã€å‰åˆ©ï¼Œé¢„ç¤ºäº‹æƒ…å‘å±•å¹³é¡ºå®‰ç¨³ã€‚å¦è±¡æ˜¾ç¤ºæ‰€é—®ä¹‹äº‹æ ¹åŸºç¨³å›ºï¼Œè™½ç„¶è¿›å±•å¯èƒ½ç¼“æ…¢ï¼Œä½†æœ€ç»ˆä¼šæœ‰å¥½çš„ç»“æœã€‚è¡Œäººèº«æœªåŠ¨ï¼Œç—…è€…ä¸»æ— å¦¨ã€‚æ±‚è°‹å®œå®ˆæ­£ï¼Œä¸å®œæ€¥è¿›ã€‚',
                characteristics: 'é™ã€å®‰ç¨³ã€å‰åˆ©ã€æ ¹åŸºç¨³å›ºã€è¿›å±•ç¼“æ…¢ä½†æœ€ç»ˆé¡ºåˆ©'
            },
            'ç•™è¿': {
                isJious: false,
                quote: 'ç•™è¿äº‹éš¾æˆï¼Œæ±‚è°‹æ—¥æœªæ˜ï¼Œå®˜äº‹åªå®œç¼“ï¼Œå»è€…æœªå›ç¨‹',
                explanation: 'ç•™è¿ä¸ºå››æ–¹åœŸï¼Œå±å››å­£ï¼Œä½åœ¨å››è§’ã€‚ç•™è¿ä¸»æ…¢ã€åå¤ã€æ‹–å»¶ï¼Œä»£è¡¨äº‹æƒ…è¿›å±•ç¼“æ…¢ï¼Œéœ€è¦è€å¿ƒç­‰å¾…ã€‚æ­¤å¦æç¤ºå½“å‰æ—¶æœºæœªåˆ°ï¼Œä¸å®œæ€¥èºè¡Œäº‹ï¼Œåº”å½“ä»å®¹åº”å¯¹ï¼Œé¡ºåŠ¿è€Œä¸ºã€‚è™½ç„¶è¿‡ç¨‹æ›²æŠ˜ï¼Œä½†ç»“æœæœªå¿…ä¸ä½³ã€‚',
                characteristics: 'ç¼“æ…¢ã€åå¤ã€æ‹–å»¶ã€éœ€è¦è€å¿ƒã€ä¸å®œæ€¥è¿›'
            },
            'é€Ÿå–œ': {
                isJious: true,
                quote: 'é€Ÿå–œå–œæ¥ä¸´ï¼Œæ±‚è´¢å‘å—è¡Œï¼Œå¤±ç‰©ç”³åˆæœªï¼Œé€¢äººè·¯ä¸Šå¯»',
                explanation: 'é€Ÿå–œä¸ºæœ±é›€ç«ï¼Œå±å¤å­£ï¼Œä½åœ¨å—æ–¹ã€‚é€Ÿå–œä¸»åŠ¨ã€å¿«é€Ÿã€å‰åˆ©ï¼Œè±¡å¾äº‹æƒ…ä¼šè¿…é€Ÿæœ‰è¿›å±•ï¼Œå¥½æ¶ˆæ¯å³å°†åˆ°æ¥ã€‚æ­¤å¦æä¸ºå‰åˆ©ï¼Œé¢„ç¤ºæ‰€é—®ä¹‹äº‹å°†å¿«é€Ÿå¾—åˆ°è§£å†³ï¼Œç»“æœä»¤äººæ»¡æ„ã€‚å®œæŠŠæ¡æ—¶æœºï¼Œç§¯æè¡ŒåŠ¨ã€‚',
                characteristics: 'å¿«é€Ÿã€å‰åˆ©ã€è¿›å±•è¿…é€Ÿã€å¥½æ¶ˆæ¯å³å°†åˆ°æ¥ã€å®œæŠŠæ¡æ—¶æœº'
            },
            'èµ¤å£': {
                isJious: false,
                quote: 'èµ¤å£ä¸»å£èˆŒï¼Œæ±‚è´¢åœ¨è¥¿å—ï¼Œå¤±ç‰©ç”³é…‰æˆŒï¼Œé€¢äººè·¯ä¸Šéš¾',
                explanation: 'èµ¤å£ä¸ºç™½è™é‡‘ï¼Œå±ç§‹å­£ï¼Œä½åœ¨è¥¿æ–¹ã€‚èµ¤å£ä¸»åµã€æ„è§ä¸å’Œï¼Œä»£è¡¨å®¹æ˜“æœ‰å£èˆŒä¹‹äº‰ï¼Œéœ€è¦è°¨æ…è¨€è¡Œã€‚æ­¤å¦æé†’åœ¨å¤„ç†ç›¸å…³äº‹åŠ¡æ—¶è¦æ ¼å¤–å°å¿ƒï¼Œé¿å…å†²çªï¼Œæ³¨æ„æ²Ÿé€šæ–¹å¼ã€‚è™½ç„¶è¿‡ç¨‹å¯èƒ½ä¸å¤ªé¡ºåˆ©ï¼Œä½†è‹¥èƒ½è°¨æ…åº”å¯¹ï¼Œå±æœºäº¦æ˜¯è½¬æœºã€‚',
                characteristics: 'å£èˆŒã€æ„è§ä¸åˆã€éœ€è¦è°¨æ…ã€é¿å…å†²çªã€åŒ–å±ä¸ºæœº'
            },
            'å°å‰': {
                isJious: true,
                quote: 'å°å‰æš—ä¸­æ±‚ï¼Œæ±‚è´¢å‘åŒ—æ–¹ï¼Œå¤±ç‰©äº¥å­ä¸‘ï¼Œé€¢äººè·¯ä¸Šè°‹',
                explanation: 'å°å‰ä¸ºç„æ­¦æ°´ï¼Œå±å†¬å­£ï¼Œä½åœ¨åŒ—æ–¹ã€‚å°å‰ä¸»åŠ¨ã€ç¼“æ…¢ã€å‰åˆ©ï¼Œé¢„ç¤ºäº‹æƒ…è™½æœ‰å°é˜»ï¼Œä½†æ•´ä½“å‘å¥½å‘å±•ã€‚æ­¤å¦è±¡å¾è™½æœ‰å°çš„å›°éš¾éœ€è¦å…‹æœï¼Œä½†æœ€ç»ˆä¼šæœ‰å°è€Œç¨³å®šçš„å¥½ç»“æœã€‚å®œç¨³æ­¥æ¨è¿›ï¼Œä¸å®œè´ªå¿«ã€‚',
                characteristics: 'ç¼“æ…¢ã€å‰åˆ©ã€å°æœ‰å›°éš¾ã€ç¨³æ­¥æ¨è¿›ã€ç¨³å®šå‘å±•'
            },
            'ç©ºäº¡': {
                isJious: false,
                quote: 'ç©ºäº¡äº‹ä¸ç¥¥ï¼Œæ±‚è´¢æ— ä¸»å¼ ï¼Œè¿›èº«ä¸å¯å–œï¼Œé€€æ­¥ä¿å®‰åº·',
                explanation: 'ç©ºäº¡ä¸ºå‹¾é™ˆåœŸï¼Œä¸åœ¨å››å­£ï¼Œä½åœ¨ä¸­å¤®ã€‚ç©ºäº¡ä¸»æ— ã€é‡å¥½åˆ™å¥½é‡ååˆ™åï¼Œä»£è¡¨å½“å‰æƒ…å†µå˜åŒ–æœªå®šï¼Œç»“æœæ¨¡ç³Šã€‚æ­¤å¦æç¤ºæ‰€é—®ä¹‹äº‹ç›®å‰ç¼ºä¹æ˜ç¡®çš„å¾å…†ï¼Œéœ€è¦æ›´å¤šçš„è§‚å¯Ÿå’Œç­‰å¾…ã€‚å¤©æ—¶ã€åœ°åˆ©ã€äººå’Œæœªå®Œå…¨å…·å¤‡ï¼Œå®œéŸ¬å…‰å…»æ™¦ï¼Œä»¥å¾…æ—¶æœºã€‚',
                characteristics: 'å˜åŒ–æœªå®šã€ç¼ºä¹æ˜ç¡®å¾å…†ã€éœ€è¦è§‚å¯Ÿç­‰å¾…ã€æ—¶æœºæœªåˆ°'
            }
        };
        
        // å…­ç¥é¡ºåº
        const godsOrder = ['å¤§å®‰', 'ç•™è¿', 'é€Ÿå–œ', 'èµ¤å£', 'å°å‰', 'ç©ºäº¡'];
        
        // DOMå…ƒç´ è·å–
        const questionInput = document.getElementById('question');
        const radioOptions = document.querySelectorAll('.radio-option');
        const numbersInput = document.getElementById('numbers-input');
        const lunarInput = document.getElementById('lunar-input');
        const lunarDaySelect = document.getElementById('lunar-day');
        const submitBtn = document.getElementById('submit-btn');
        const resultSection = document.getElementById('result-section');
        const summaryContent = document.getElementById('summary-content');
        const godDetails = document.getElementById('god-details');
        const adviceContent = document.getElementById('advice-content');
        const resetBtn = document.getElementById('reset-btn');
        const copyBtn = document.getElementById('copy-btn');
        
        // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©
        function initDaySelect() {
            lunarDaySelect.innerHTML = '<option value="">é€‰æ‹©æ—¥æœŸ</option>';
            for (let i = 1; i <= 30; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i + 'æ—¥';
                lunarDaySelect.appendChild(option);
            }
        }
        
        // åˆ‡æ¢èµ·å¦æ–¹å¼
        function switchDivinationType(type) {
            radioOptions.forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.value === type) {
                    option.classList.add('selected');
                }
            });
            
            if (type === 'numbers') {
                numbersInput.classList.add('show');
                lunarInput.classList.remove('show');
            } else {
                numbersInput.classList.remove('show');
                lunarInput.classList.add('show');
            }
        }
        
        // è·å–ä¸‰ä¸ªæ•°å­—
        function getThreeNumbers() {
            const type = document.querySelector('.radio-option.selected').dataset.value;
            
            if (type === 'numbers') {
                const num1 = parseInt(document.getElementById('num1').value);
                const num2 = parseInt(document.getElementById('num2').value);
                const num3 = parseInt(document.getElementById('num3').value);
                
                if (!num1 || !num2 || !num3) {
                    throw new Error('è¯·è¾“å…¥ä¸‰ä¸ªå®Œæ•´çš„æ•°å­—');
                }
                
                return [num1, num2, num3];
            } else {
                const month = parseInt(document.getElementById('lunar-month').value);
                const day = parseInt(document.getElementById('lunar-day').value);
                const hour = parseInt(document.getElementById('lunar-hour').value);
                
                if (!month || !day || !hour) {
                    throw new Error('è¯·é€‰æ‹©å®Œæ•´çš„é˜´å†æœˆã€æ—¥ã€æ—¶è¾°');
                }
                
                return [month, day, hour];
            }
        }
        
        // å°å…­å£¬ç®—æ³•ï¼šè·å–ç¬¬å…­ä¸ªä½ç½®ä¸Šçš„ç¥
        function getGodAtPosition(startGod, count) {
            const startIndex = godsOrder.indexOf(startGod);
            const targetIndex = (startIndex + count - 1) % 6;
            return godsOrder[targetIndex];
        }
        
        // è®¡ç®—å¦è±¡
        function calculateDivination(numbers) {
            const [num1, num2, num3] = numbers;
            
            // ç¬¬ä¸€ä¸ªç¥ï¼šä»å¤§å®‰å¼€å§‹æ•°åˆ°ç¬¬ä¸€ä¸ªæ•°å­—
            const firstGod = getGodAtPosition('å¤§å®‰', num1);
            
            // ç¬¬äºŒä¸ªç¥ï¼šä»ç¬¬ä¸€ä¸ªç¥å¼€å§‹æ•°åˆ°ç¬¬äºŒä¸ªæ•°å­—
            const secondGod = getGodAtPosition(firstGod, num2);
            
            // ç¬¬ä¸‰ä¸ªç¥ï¼šä»ç¬¬äºŒä¸ªç¥å¼€å§‹æ•°åˆ°ç¬¬ä¸‰ä¸ªæ•°å­—
            const thirdGod = getGodAtPosition(secondGod, num3);
            
            return [firstGod, secondGod, thirdGod];
        }
        
        // ç”Ÿæˆç»“æœ
        function generateResult(gods, question) {
            // ç”Ÿæˆå¦è±¡æ€»è§ˆ
            const summaryHTML = gods.map(god => {
                const isJious = godsData[god].isJious;
                const className = isJious ? 'god-jious' : 'god-xiong';
                return `<span class="divine-god ${className}">${god}</span>`;
            }).join(' â†’ ');
            summaryContent.innerHTML = summaryHTML;
            
            // ç”Ÿæˆå…­ç¥è¯¦è§£
            const detailsHTML = gods.map(god => {
                const data = godsData[god];
                const className = data.isJious ? 'god-jious' : 'god-xiong';
                
                return `
                    <div class="god-card">
                        <div class="god-name ${className}">${god}</div>
                        <div class="god-quote">"${data.quote}"</div>
                        <div class="god-explanation">${data.explanation}</div>
                    </div>
                `;
            }).join('');
            godDetails.innerHTML = detailsHTML;
            
            // ç”Ÿæˆå»ºè®®
            const adviceHTML = generateAdvice(gods, question);
            adviceContent.innerHTML = adviceHTML;
        }
        
        // ç”Ÿæˆå»ºè®®
        function generateAdvice(gods, question) {
            // ç”ŸæˆAIæŒ‡ä»¤æ ¼å¼çš„å»ºè®®
            const aiInstruction = `æˆ‘ç”¨å°å…­å£¬èµ·è¯¾ï¼Œæ‰€è¯¢é—®çš„é—®é¢˜æ˜¯ï¼š${question}ï¼Œå¾—åˆ°çš„ä¸‰ä¸ªç”¨ç¥åˆ†åˆ«ä¸ºï¼š${gods.join('ã€')}ï¼Œè¯·å¸®æˆ‘è¯¦ç»†è§£é‡Šã€‚`;
            
            return aiInstruction;
        }
        
        // å¤åˆ¶åŠŸèƒ½
        async function copyToClipboard(text) {
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    // ä½¿ç”¨ç°ä»£ Clipboard API
                    await navigator.clipboard.writeText(text);
                    return true;
                } else {
                    // å¤‡ç”¨æ–¹æ³•ï¼šä½¿ç”¨ä¼ ç»Ÿçš„ execCommand
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    textArea.style.pointerEvents = 'none';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    return successful;
                }
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                return false;
            }
        }
        
        // æ˜¾ç¤ºå¤åˆ¶åé¦ˆ
        function showCopyFeedback() {
            const feedback = document.getElementById('copy-feedback');
            feedback.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 3000);
        }
        
        // é”™è¯¯å¤„ç†ä¼˜åŒ–
        function handleError(error, context = '') {
            console.error('å°å…­å£¬åº”ç”¨é”™è¯¯:', error, 'ä¸Šä¸‹æ–‡:', context);
            
            // å‹å¥½çš„é”™è¯¯æç¤º
            const errorMsg = error.message || 'å‘ç”Ÿäº†æœªçŸ¥é”™è¯¯';
            if (errorMsg.includes('ç½‘ç»œ') || errorMsg.includes('è”ç½‘')) {
                alert('ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œä½†ç¦»çº¿åŠŸèƒ½ä»ç„¶å¯ç”¨');
            } else if (errorMsg.includes('æœåŠ¡')) {
                alert('æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•');
            } else {
                alert('æ“ä½œå¤±è´¥ï¼š' + errorMsg);
            }
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        radioOptions.forEach(option => {
            option.addEventListener('click', () => {
                switchDivinationType(option.dataset.value);
            });
        });
        
        submitBtn.addEventListener('click', () => {
            const question = questionInput.value.trim();
            
            if (!question) {
                handleError(new Error('è¯·è¾“å…¥æ‚¨æƒ³æµ‹ç®—çš„é—®é¢˜'), 'submit');
                return;
            }
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="loading"></span> æ¨æ¼”ä¸­...';
                
                setTimeout(() => {
                    const numbers = getThreeNumbers();
                    const gods = calculateDivination(numbers);
                    generateResult(gods, question);
                    
                    resultSection.classList.add('show');
                    resultSection.scrollIntoView({ behavior: 'smooth' });
                    
                    // ç§»åŠ¨ç«¯è§¦è§‰åé¦ˆ
                    if (navigator.vibrate) {
                        // æ ¹æ®å‰å‡¶ç»™å‡ºä¸åŒçš„æŒ¯åŠ¨æ¨¡å¼
                        const jiousCount = gods.filter(god => godsData[god].isJious).length;
                        if (jiousCount >= 2) {
                            navigator.vibrate([100, 50, 100]); // å‰åˆ© - ä¸¤æ¬¡çŸ­æŒ¯
                        } else if (jiousCount === 1) {
                            navigator.vibrate(200); // ä¸­æ€§ - ä¸€æ¬¡ä¸­æŒ¯
                        } else {
                            navigator.vibrate([50, 100, 50, 100, 50]); // å‡¶é™© - ä¸‰æ¬¡çŸ­æŒ¯
                        }
                    }
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'å¼€å§‹æµ‹ç®—';
                }, 500); // ç¨å¾®å»¶è¿Ÿå¢åŠ ä»ªå¼æ„Ÿ
                
            } catch (error) {
                handleError(error, 'calculate');
                submitBtn.disabled = false;
                submitBtn.textContent = 'å¼€å§‹æµ‹ç®—';
            }
        });
        
        resetBtn.addEventListener('click', () => {
            questionInput.value = '';
            document.getElementById('num1').value = '';
            document.getElementById('num2').value = '';
            document.getElementById('num3').value = '';
            document.getElementById('lunar-month').value = '';
            document.getElementById('lunar-day').value = '';
            document.getElementById('lunar-hour').value = '';
            resultSection.classList.remove('show');
            questionInput.focus();
            
            // ç§»åŠ¨ç«¯è§¦è§‰åé¦ˆ
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
        });
        
        // å¤åˆ¶æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
        copyBtn.addEventListener('click', async () => {
            const copyText = adviceContent.textContent.trim();
            
            if (!copyText) {
                handleError(new Error('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹'), 'copy');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            copyBtn.disabled = true;
            const originalText = copyBtn.querySelector('.copy-text').textContent;
            copyBtn.querySelector('.copy-text').textContent = 'å¤åˆ¶ä¸­...';
            
            try {
                const success = await copyToClipboard(copyText);
                if (success) {
                    showCopyFeedback();
                    
                    // ç§»åŠ¨ç«¯è§¦è§‰åé¦ˆ
                    if (navigator.vibrate) {
                        navigator.vibrate([100, 50, 100]); // æˆåŠŸåé¦ˆ
                    }
                } else {
                    throw new Error('å¤åˆ¶æ“ä½œå¤±è´¥');
                }
            } catch (error) {
                handleError(error, 'copy');
                // å¦‚æœå¤åˆ¶å¤±è´¥ï¼Œå¯ä»¥æä¾›æ‰‹åŠ¨é€‰æ‹©çš„æç¤º
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¹¶å¤åˆ¶');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                copyBtn.disabled = false;
                copyBtn.querySelector('.copy-text').textContent = originalText;
            }
        });

        
        // åˆå§‹åŒ–
        initDaySelect();
        

        
        // Service Worker æ³¨å†Œ
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then((registration) => {
                        console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration);
                    })
                    .catch((registrationError) => {
                        console.log('Service Worker æ³¨å†Œå¤±è´¥:', registrationError);
                    });
            });
        }
        
        // PWA å®‰è£…æç¤º
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });
        
        function showInstallButton() {
            const installButton = document.createElement('button');
            installButton.textContent = 'ğŸ“± å®‰è£…åˆ°æ¡Œé¢';
            installButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #A42A28;
                color: #F5F1E9;
                border: none;
                border-radius: 25px;
                padding: 12px 24px;
                font-size: 14px;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(164, 42, 40, 0.3);
                cursor: pointer;
                z-index: 1000;
                transition: all 250ms ease;
                font-family: 'Noto Serif SC', serif;
            `;
            
            installButton.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    deferredPrompt = null;
                    installButton.remove();
                }
            });
            
            document.body.appendChild(installButton);
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                if (installButton.parentNode) {
                    installButton.style.opacity = '0';
                    installButton.style.transform = 'translateX(-50%) translateY(10px)';
                    setTimeout(() => installButton.remove(), 300);
                }
            }, 8000);
        }
    </script>
</body>
</html>